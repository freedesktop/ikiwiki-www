[[!inline pages="Software/PulseAudio/TOC" quick="yes" raw="yes"]]

# PulseAudio 5.0 Release Notes (draft)

Draft status: checked commits since v4.0 until 795e488f2530663a8252ac19f4efd85afd33c903

TODO: Write an introduction, mention the GSoC projects and new maintainer.


## Changes at a glance

* BlueZ 5 support (A2DP only)
* Reimplementation of the tunnel modules
* Small changes here and there
* Many bug fixes


## Notes for Application Developers

The pa_card_profile_info struct is deprecated, consider migrating to pa_card_profile_info2. The old struct will keep working, though, so applications should not break even if they are not updated.


## Notes for Packagers

PulseAudio now supports BlueZ 5, but only the A2DP profile. BlueZ 4 is still the only way to make HSP/HFP work. It's possible to build PulseAudio with support for both BlueZ versions.

The build dependency to libbluetooth has been dropped.

We now use upstream gettext instead of the GLib version. The minimum required version is 0.18.1.

The minimum supported alsa-lib version is now 1.0.19 (down from 1.0.24).


## Changes in More Detail

### BlueZ 5 support (A2DP only)

TODO: This is one of the most significant changes in this release. We already have a note for packagers above, but we probably should have some longer explanation here about what makes BlueZ 5 so great for users, and also what doesn't work and why. And what is required for the not-yet-working stuff to start working.


### Utility changes:

parecord and parec now support the --monitor-stream option, which allows recording from a single playback stream.

pacmd doesn't print the welcome message and the command prompt in non-interactive mode any more.

pacmd now supports "newfile:somefile.log" as a target for the set-log-target command. "newfile:somefile.log" means that somefile.log will not be overwritten if it already exists. Instead, a new file with name somefile.log.1 will be created. The "newfile:" target was already supported in the daemon configuration file, this change just brings pacmd to the same level.


### Module changes:

module-bluetooth-discover and module-bluetooth-device have been renamed to module-bluez4-discover and module-bluez4-device. There is still a module called module-bluetooth-discover - that's a new module that serves as a compatibility layer. The new module-bluetooth-discover loads module-bluez5-discover or module-bluez4-discover based on which version is available in the system (if both modules exist, then both are loaded, but depending on the running bluetoothd version, only one of them will interact with BlueZ).

New module: module-bluez5-discover. This is the module that enables BlueZ 5 support. It's recommended to use module-bluetooth-discover in configuration files, however, to keep the configuration file compatible with future BlueZ versions.

New modules: module-tunnel-sink-new and module-tunnel-source-new. They are reimplementations of module-tunnel-sink and module-tunnel-source. They're not quite finished yet, but if you're having trouble with the tunnel modules, it's worth trying if these new implementations work better. Note, however, that module-tunnel-sink-new will be renamed to module-tunnel-sink once it's ready (and the same for module-tunnel-source-new), so if you use module-tunnel-sink-new in your configuration, your configuration will break once that renaming happens.

module-tunnel-sink and module-tunnel-source (the old versions) now support the "auto" argument. If it's set to true, then the default connection parameters are gathered from the environment in the same way as applications do. This is usually a bad idea, because often that will cause the server to connect to itself, but some people found this feature useful for their purposes.

When module-suspend-on-idle reads the timeout property from sinks and sources, it now treats a negative timeout as "never suspend" instead of ignoring the property.

module-alsa-card now prefers to adjust the "Capture" volume in the ALSA mixer instead of boosts, e.g. "Mic Boost". This should result in less noise in the captured audio on some hardware.

module-alsa-card now supports the "PlaybackRate" and "CaptureRate" UCM device options.

When using ALSA UCM, module-alsa-card now assigns lower priority to ports that combine multiple devices than ports that use only one device.

module-loopback maximum configurable latency has been increased from 2 seconds to 30 seconds.

module-bluetooth-proximity has been removed. It was probably not used by anyone, since it required an ancient version of BlueZ to work.


### Configuration syntax changes:

In path configuration files (/usr/share/pulseaudio/alsa-mixer/paths/*) the "name" option in the "General" section is not supported any more. The path name is now determined solely based on the file name. The "name" option was also used as a key to a table containing path descriptions, and that functionality is now provided by a new option called "description-key".

A single path can't be used for both input and output any more.


### Hardware support changes:

Jack detection support for line out jacks has been added. TODO: Any concrete benefits for users?

A configuration file for Native Instruments Traktor Audio 2 was missing from the 4.0 tarball. It's now shipped with 5.0, so users of that hardware actually get the benefit from the configuration file (which allows PulseAudio to use both outputs of the sound card).


### libpulse changes:

An "available" flag has been added to the card profile info. If a profile is not available, activating it doesn't make sense. GUIs that allow the user to control the card profile can use the new flag to hide unavailable profiles.

Adding the "available" flag to the existing pa_card_profile_info struct turned out to break the ABI due to an earlier design mistake, so instead of extending pa_card_profile_info, we had to introduce pa_card_profile_info2, which contains the same information as the old struct plus the new "available" flag. The old pa_card_profile_info struct is now deprecated. The "profiles" field in pa_card_port_info and the "profiles" and "active_profile" fields in pa_card_info are deprecated too, superseded by the "profiles2" field in pa_card_port_info and "profiles2" and "active_profile2" fields in pa_card_info.

New function: pa_context_load_cookie_from_file(). This allows clients to load the authentication cookie from a custom file. It may be that there are no applications that need this - the reason for adding the function was that module-tunnel-sink-new needed it.

New function: pa_threaded_mainloop_set_name(). This is used internally in PulseAudio, for improving the server log messages when using pa_threaded_mainloop. The usefulness of this new function is probably very limited for applications.


### libpulse Vala bindings changes:

The binding for pa_cvolume_set() was missing, now CVolume.set() has been added.


### Performance improvements:

Improved float->s16 and s16->float sample conversion for ARM NEON.


## Next Steps

HSP/HFP support for BlueZ 5 will hopefully arrive in the next PulseAudio release, but that requires someone to write the code for that. Some code already exists, but it hasn't been submitted for upstream inclusion, and lately there has not been much visible progress on that front (TODO: check the latest status and plans from Jo√£o).


## git shortlog

<pre>
TODO: Output of "git shortlog v4.0..v5.0" goes here.
</pre>
