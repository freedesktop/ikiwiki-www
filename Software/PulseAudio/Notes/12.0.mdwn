[[!inline pages="Software/PulseAudio/TOC" quick="yes" raw="yes"]]

# PulseAudio 12.0 release notes (draft)

## Changes at a glance

 * Much more accurate latency reporting for AirPlay devices
 * module-switch-on-connect now ignores virtual devices
 * When using passthrough for compressed audio, set the "non-audio" bit
 * Prioritize HDMI output over S/PDIF output
 * HSP support for more bluetooth headsets
 * Choose the A2DP bluetooth profile by default instead of HSP
 * New "sink_input_properties" module argument for module-ladspa-sink
 * New "use_system_clock_for_timing" module argument for module-pipe-sink
 * Fixed a crash or high CPU use problem with Intel HDMI LPE
 * Steelseries Arctis 7 USB headset stereo output support
 * Dell Thunderbolt Dock TB16 speaker jack support
 * Fixed digital input support for some USB sound cards
 * Fixed Native Instruments Traktor Audio 6 detection
 * Ability to disable input or output on macOS
 * New "dereverb" option for the Speex echo canceller
 * New module: module-always-source
 * State files not any more readable by all users in the system mode
 * module-augment-properties now uses XDG_DATA_DIRS to find .desktop files
 * The GConf dependency can now be avoided
 * qpaeq license changed from AGPL to LGPL
 * qpaeq ported to Qt 5

## Notes for end users

### Much more accurate latency reporting for AirPlay devices

When playing videos, it's important that the audio latency is known so that the video can be synchronized accurately. The AirPlay protocol has a large latency, but PulseAudio didn't previously report that latency to applications. Now it reports it, or at least something much closer to the reality than before.

The AirPlay protocol doesn't provide a mechanism for getting the exact latency (or if it does, we're not aware of that). PulseAudio makes an educated guess, and a significant part of that guess is a latency constant that is added to each latency report. The default value for that constant is exactly 2 seconds, but that's not optimal for all devices. PulseAudio uses a different constant for some known devices, and we'd like to expand the set of known devices. If you find that audio-video synchronization is bad with your AirPlay device, you can experiment with different latency constants by passing argument "latency_msec=2000" to module-raop-discover in /etc/pulse/default.pa. Change the number 2000 to something that works better. Once you find a better latency value, we'd be happy hear from you so that we can add your device to the list of known devices.

### module-switch-on-connect now ignores virtual devices

When a new device appears, module-switch-on-connect makes the new device the default device and moves existing streams there. The module is not loaded by default, because there are cases where this is not what users generally want. One of those cases has been virtual devices - for example, if the user (or some application) creates a null sink for some purpose, it's probably not a good idea to make the null sink the default device, but previously module-switch-on-connect didn't make any distinction between different kinds of devices. Now the module ignores virtual devices, unless the "ignore_virtual=no" argument is passed when loading it.

### When using passthrough for compressed audio, set the "non-audio" bit

When playing compressed audio through S/PDIF or HDMI, it should be indicated that the data is not normal uncompressed audio, otherwise the receiver might play some horrible noise. It seems that PulseAudio never set the "non-audio" bit properly. There hasn't been any complaints about this until recently, so apparently receivers generally detect compressed audio pretty well even without the "non-audio" bit being set, but in any case, now PulseAudio does set that bit.

### Prioritize HDMI output over S/PDIF output

HDMI output is probably used more often than S/PDIF output, so if PulseAudio has to pick one, it's better to pick HDMI. Previously S/PDIF had higher priority than HDMI.

### HSP support for more bluetooth headsets

When connecting a bluetooth headset, the headset sends a list of features that it supports. Headsets can indicate HSP support in two different ways, but PulseAudio used to recognize only one way, so to PulseAudio it seemed that some headsets didn't support HSP even when in reality they did. Now both kinds of headsets are supported.

### Choose the A2DP bluetooth profile by default instead of HSP

When connecting a new bluetooth headset, PulseAudio used to activate the HSP profile by default. Now A2DP has higher priority. A2DP is a better default, because it has better audio quality. HSP is needed with phone applications, but we already have automatic profile switching when a phone application appears, so using A2DP as the default profile shouldn't cause problems even when using bluetooth primarily for phone calls.

### New "sink_input_properties" argument for module-ladspa-sink

The new "sink_input_properties" argument for module-ladspa-sink makes it possible to control the properties that are set on the sink input that the module creates. For example, passing "sink_input_properties=media.name=foo" sets the stream description to "foo", which will be shown in volume control applications.

### New "use_system_clock_for_timing" module argument for module-pipe-sink

module-pipe-sink plays audio to a pipe file, and it has so far relied on the program reading from the pipe to provide timing. That is, module-pipe-sink writes to the pipe as fast as the data is read from the pipe. If the program reading the data doesn't do any timing, and simply reads as fast as data becomes available, the playback pipeline runs too fast and applications playing to the pipe sink won't be able to provide data fast enough, causing silence to be added to the audio stream.

Now it's possible to pass the "use_system_clock_for_timing=yes" option to module-pipe-sink to support simple programs (e.g. "cat") that just read from the pipe as fast as data becomes available. When the option is enabled, PulseAudio uses the system clock to make writes happen at the normal rate.

### Fixed a crash or high CPU use problem with Intel HDMI LPE

Many recent computers use the Intel HDMI LPE kernel driver for HDMI audio, and that driver has some unususal behaviour that made PulseAudio enter an infinite loop with 100% CPU use, if the HDMI cable is unplugged and PulseAudio tries to play to the HDMI output. Usually the playback thread runs with realtime scheduling, and using too much CPU in that situation makes the kernel kill PulseAudio, so effectively PulseAudio appeared to be crashing. This problem has now been fixed.

### Steelseries Arctis 7 USB headset stereo output support

The headset is unusual in that it presents itself as two output devices: a mono device (meant for voice audio) and a stereo device (for everything else), and both devices have separate volume control at the hardware level. PulseAudio used to make only the mono device available by default, now both devices can be used at the same time.

### Dell Thunderbolt Dock TB16 speaker jack support

TB16 has a speaker jack that PulseAudio didn't previously make available by default. That has now been fixed.

### Fixed digital input support for some USB sound cards

Some USB sound cards require the "PCM Capture Source" control in the ALSA mixer to be set to "IEC958 In" in order to be able to record from the digital input, but PulseAudio didn't do that. Now it does.

### Fixed Native Instruments Traktor Audio 6 detection

PulseAudio has custom configuration for the Traktor Audio 6 USB sound card, but either the device ID that PulseAudio used to detect the card was wrong, or maybe some units use one ID and some use another. PulseAudio now detects the card with either ID.

### Ability to disable input or output on macOS

module-coreaudio-detect and module-coreaudio-device now have the "record" and "playback" boolean options that can be used to disable the respective functionality.

### New "dereverb" option for the Speex echo canceller

The Speex backend of module-echo-cancel has a new "dereverb" boolean option. The option is enabled by default. TODO: Explain what the dereverb processing does.

### New module: module-always-source

The new module makes sure that there's always at least one non-monitor source available in the system. If you're running into situations where there are no "proper" input devices, and you'd rather use a null source that only produces silence as the default input device rather than a monitor source that copies the audio from the default output, this is for you.

module-always-source is not loaded by default.

### State files not any more readable by all users in the system mode

PulseAudio used to set the process umask to 022. That meant that the state files that PulseAudio writes on disk were readable by all users when running PulseAudio in the "system mode", i.e. only one instance that all users share. Now the umask is 077, so users can't read the state files any more, which is a slight improvement in privacy, because the state files might contain e.g. information about what applications users use.

The umask change also affects the file permissions in the default setup where each user runs their own PulseAudio instance, but in that mode the files are written in a directory that other users can't access, so there shouldn't be any practical difference.

### module-augment-properties now uses XDG_DATA_DIRS to find .desktop files

module-augment-properties reads [[.desktop files|https://standards.freedesktop.org/desktop-entry-spec/latest/]] to get more information about applications that connect to the server. Previously the .desktop files were searched only from one fixed location (/usr/share/applications), but now the module supports also the XDG_DATA_DIRS environment variable for specifying additional search paths.

## Notes for application developers

Nothing here yet...

## Notes for packagers

### The GConf dependency can now be avoided

paprefs has so far required module-gconf to be loaded in the PulseAudio daemon, which is bad, because GConf is deprecated and unmaintained. A new paprefs version is expected to be released shortly, and that will use GSettings instead of GConf. The new paprefs version requires module-gsettings to be loaded in the PulseAudio daemon.

PulseAudio still provides module-gconf in case there's need for it. GSettings and GConf can both be enabled when building PulseAudio, but note that both modules should not be installed at the same time, so distributions should make module-gconf conflict with module-gsettings in their packaging system. It may be useful to enable both when building PulseAudio, so that PulseAudio can be updated before paprefs. If only GSettings is enabled, PulseAudio and paprefs need to be updated at the same time.

There can be some problems for users after updating paprefs. When module-gsettings is installed along with the new paprefs version, the module won't be automatically loaded by the PulseAudio daemon that is already running during the update, so any configuration changes done with paprefs will have effect only after the daemon has been restarted. Another issue is that if the gsettings-data-convert program is not installed, the old settings from GConf won't be migrated to GSettings. gsettings-data-convert is provided by GConf, so to ensure that the program is installed, the module-gsettings package would have to depend on GConf, but since the whole point of this exercise is to get rid of GConf, such dependency may not be feasible.

### qpaeq license changed from AGPL to LGPL

Most of PulseAudio's code is licensed under LGPLv2.1, but the equalizer GUI qpaeq was licensed under AGPL. qpaeq is now licensed under LGPLv2.1, so there's one less exception in PulseAudio's licensing terms.

### qpaeq ported to Qt 5

qpaeq used to depend on Qt 4, which was not nice, since the Qt project has stopped supporting the 4.x releases. qpaeq has now been ported to Qt 5.

## git shortlog

<pre>
TODO
</pre>
