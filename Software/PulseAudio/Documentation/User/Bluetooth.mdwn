[[!inline pages="Software/PulseAudio/TOC" quick="yes" raw="yes"]]

# Bluetooth

PulseAudio depends on [[BlueZ|http://www.bluez.org]] for all Bluetooth functionality, and additionally [[oFono|https://01.org/ofono]] is required for HFP support.

## Profiles

The bluetooth standard specifies three audio profiles. Don't confuse these with the "card profile" concept in PulseAudio. A bluetooth device shows up in PulseAudio as a card, and the card will have some set of profiles depending on what bluetooth profiles the device supports, but the "bluetooth profile" <-> "card profile" mapping is not one-to-one. The three bluetooth profiles are:

* A2DP (Advanced Audio Distribution Profile) - high-quality audio playback, appropriate for e.g. listening to music.
* HSP (HeadSet Profile) - phone-quality audio playback and recording, appropriate for phone calls.
* HFP (Hands-Free Profile) - same as HSP, but with additional functionality for managing phone calls.

Each of the profiles are further divided into two roles:

* A2DP:
  * Source role - the device that sends audio.
  * Sink role - the device that receives audio.
* HSP:
  * Audio Gateway role - the device that the headset is connected to. The HSP profile is typically used in phone calls, and this is the device that is connected to the cellular network (for cellular phone calls) or to the internet (for VoIP calls). Typically a cellular phone or a personal computer.
  * Headset role - the headset, obviously. This is where the speakers and microphone are.
* HFP:
  * Audio Gateway role - the device that the hands-free device is connected to. The HFP profile is typically used for cellular phone calls, and this is the device that is connected to the cellular network. Typically a cellular phone.
  * Hands-Free Unit role - the device with the speakers and microphone.

## A2DP

PulseAudio supports A2DP in both source and sink roles. When PulseAudio acts in the source role, a sink is created where applications can play to. When PulseAudio acts in the sink role, a source is created where applications can record from.

A2DP works generally without a hassle, although when watching videos, the audio can get badly out of sync. It seems that in case of transmission problems (weak signal, or out of signal range) the kernel can buffer quite a lot of audio. PulseAudio doesn't know how much the kernel has audio buffered, so PulseAudio can neither report the latency accurately, nor wait until the kernel buffer fill level goes down to a more reasonable level. We currently lack a person who would have both the time and the skills to resolve this problem. Help would be greatly appreciated. Here's a bug report about this issue: [[https://bugs.freedesktop.org/show_bug.cgi?id=95411]].

## HSP

PulseAudio supports HSP only in the audio gateway role, so headsets can be used with PulseAudio, but PulseAudio can't act as a headset. (With BlueZ 4 both roles are supported, but almost everyone uses BlueZ 5 nowadays.) With the "Headset Head Unit (HSP/HFP)" card profile selected, PulseAudio will create a sink and a source that applications can use to play back and record audio.

The HSP implementation in PulseAudio is mutually exclusive with the HFP implementation, so users have to choose which one is more important to them. There's no reason why the two profiles absolutely have to be mutually exclusive, but that's the way it is for now.

HSP support is enabled by passing argument "headset=native" to module-bluetooth-discover in /etc/pulse/default.pa. Or the argument can be omitted, because HSP is enabled by default.

The headset role will eventually be supported too. In fact, there's already a patch for that: [[https://lists.freedesktop.org/archives/pulseaudio-discuss/2015-February/023242.html]]. Arun reviewed the patch, and there was something to fix in the patch, but the feedback was given in IRC, so the details are not archived. No new version of the patch has been submitted. Contact Arun Raghavan and Wim Taymans if you want more information about this, or if you want to help finishing the work.

## HFP

TODO
